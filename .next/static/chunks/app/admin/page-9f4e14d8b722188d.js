(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{2802:function(e,s,a){Promise.resolve().then(a.bind(a,3721))},3721:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return T}});var t,l=a(7437),i=a(998),r=a(6463),n=a(2265);function c(){let{data:e,status:s,update:a}=(0,i.useSession)(),t=(0,r.useRouter)(),l=(0,n.useCallback)(async(e,s)=>{try{let a=await (0,i.signIn)("credentials",{redirect:!1,email:e,password:s});if(null==a?void 0:a.error){let e="Erro ao fazer login";switch(a.error){case"CredentialsSignin":e="Email ou senha inv\xe1lidos";break;case"Callback":e="Erro de autentica\xe7\xe3o";break;default:e=a.error}return{success:!1,error:e}}if(null==a?void 0:a.ok)return{success:!0};return{success:!1,error:"Erro desconhecido ao fazer login"}}catch(e){return{success:!1,error:"Falha na conex\xe3o. Tente novamente."}}},[]),c=(0,n.useCallback)(async()=>{try{await (0,i.signIn)("google",{redirect:!1})}catch(e){throw console.error("Google login error:",e),Error("Falha ao iniciar login com Google")}},[]),d=(0,n.useCallback)(async()=>{try{await (0,i.signOut)({redirect:!1,callbackUrl:"/login"}),t.push("/login")}catch(e){console.error("Logout error:",e),t.push("/login")}},[t]),o=(0,n.useCallback)(async()=>{try{await a()}catch(e){console.error("Session refresh error:",e)}},[a]);return{user:(null==e?void 0:e.user)?{id:e.user.id,name:e.user.name,email:e.user.email,image:e.user.image,firstName:e.user.firstName,lastName:e.user.lastName,emailVerified:e.user.emailVerified,role:e.user.role}:null,isLoading:"loading"===s,isAuthenticated:!!(null==e?void 0:e.user),isError:"unauthenticated"===s&&!e,login:l,loginWithGoogle:c,logout:d,refreshSession:o}}a(222),a(2229);var d=a(763),o=a(902),m=a(4165),x=a(7090),u=a(357);let h=null!==(t=globalThis.prisma)&&void 0!==t?t:new x.PrismaClient({log:["error"],datasources:{db:{url:u.env.DATABASE_URL}}});var p=a(7513),N=a.n(p),f=a(6700),g=a(357);let j=f.z.object({email:f.z.string().email(),password:f.z.string().min(6)});(0,m.N)(h),[(0,o.Z)({name:"Email e Senha",credentials:{email:{label:"Email",type:"email",placeholder:"seu@email.com"},password:{label:"Senha",type:"password"}},async authorize(e){let s=j.safeParse(e);if(!s.success)throw Error("Credenciais inv\xe1lidas");let{email:a,password:t}=s.data,l=await h.user.findUnique({where:{email:a}});if(!l||!l.password||!await N().compare(t,l.password))throw Error("Usu\xe1rio ou senha inv\xe1lidos");return{id:l.id,email:l.email,name:l.name||"".concat(l.firstName||""," ").concat(l.lastName||"").trim()||null,image:l.image,firstName:l.firstName,lastName:l.lastName,emailVerified:l.emailVerified,role:l.role}}}),...g.env.GOOGLE_CLIENT_ID&&g.env.GOOGLE_CLIENT_SECRET?[(0,d.Z)({clientId:g.env.GOOGLE_CLIENT_ID,clientSecret:g.env.GOOGLE_CLIENT_SECRET,authorization:{params:{scope:"openid email profile"}},profile:e=>({id:e.sub,name:e.name||null,email:e.email,image:e.picture||null,emailVerified:e.email_verified?new Date:null,firstName:e.given_name||null,lastName:e.family_name||null})})]:[]],a(357);let b="USER",E="ADMIN",v={DOCUMENT_READ:"document:read",DOCUMENT_WRITE:"document:write",DOCUMENT_DELETE:"document:delete",DOCUMENT_SHARE:"document:share",USER_READ:"user:read",USER_WRITE:"user:write",USER_DELETE:"user:delete",ADMIN_PANEL:"admin:panel",AUDIT_LOG_READ:"audit:read",SYSTEM_CONFIG:"system:config"};v.DOCUMENT_READ,v.DOCUMENT_WRITE,v.DOCUMENT_DELETE,v.DOCUMENT_SHARE,[...Object.values(v)];let w={[b]:[v.DOCUMENT_READ,v.DOCUMENT_WRITE,v.DOCUMENT_DELETE,v.DOCUMENT_SHARE],[E]:[...Object.values(v)]};function y(){let{user:e,isAuthenticated:s}=c(),a=(0,n.useMemo)(()=>s&&(null==e?void 0:e.role)?e.role:null,[s,null==e?void 0:e.role]),t=(0,n.useMemo)(()=>a&&w[a]||[],[a]),l=(0,n.useMemo)(()=>e=>!!s&&t.includes(e),[s,t]),i=(0,n.useMemo)(()=>e=>!!s&&a===e,[s,a]),r=(0,n.useMemo)(()=>e=>!!s&&!!a&&e.includes(a),[s,a]),d=(0,n.useMemo)(()=>e=>!!s&&e.every(e=>t.includes(e)),[s,t]),o=(0,n.useMemo)(()=>e=>!!s&&e.some(e=>t.includes(e)),[s,t]),m=(0,n.useMemo)(()=>i(E),[i]),x=(0,n.useMemo)(()=>i(b),[i]);return{hasPermission:l,hasRole:i,hasAnyRole:r,hasAllPermissions:d,hasAnyPermission:o,userRole:a,userPermissions:t,isAdmin:m,isUser:x}}function _(e){let{permission:s,children:a,fallback:t=null}=e,{hasPermission:i}=y();return i(s)?(0,l.jsx)(l.Fragment,{children:a}):(0,l.jsx)(l.Fragment,{children:t})}function D(e){let{role:s,children:a,fallback:t=null}=e,{hasRole:i}=y();return i(s)?(0,l.jsx)(l.Fragment,{children:a}):(0,l.jsx)(l.Fragment,{children:t})}function T(){!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{redirectTo:s="/login",redirectIfFound:a=!1}=e,{user:t,isLoading:l,isAuthenticated:i}=c(),d=(0,r.useRouter)();(0,n.useEffect)(()=>{if(!l){if(a)i&&d.push(s);else if(!i){let e=window.location.pathname+window.location.search,s="/login?callbackUrl=".concat(encodeURIComponent(e));d.push(s)}}},[l,i,s,a,d])}();let{user:e,isLoading:s}=c(),{isAdmin:a,hasPermission:t}=y(),[i,d]=(0,n.useState)([]),[o,m]=(0,n.useState)([]),[x,u]=(0,n.useState)(!0),[h,p]=(0,n.useState)(null);return((0,n.useEffect)(()=>{a&&(async()=>{try{u(!0);let e=await fetch("/api/admin/users?limit=5");if(e.ok){let s=await e.json();d(s.users||[])}let s=await fetch("/api/admin/audit?limit=10");if(s.ok){let e=await s.json();m(e.auditLogs||[])}}catch(e){console.error("Error fetching admin data:",e),p("Failed to load admin data")}finally{u(!1)}})()},[a]),s||x)?(0,l.jsx)("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,l.jsx)("p",{className:"mt-4 text-slate-600",children:"Carregando painel administrativo..."})]})}):(0,l.jsx)(D,{role:E,fallback:(0,l.jsx)("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-xl p-8 text-center",children:[(0,l.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"\uD83D\uDEAB"}),(0,l.jsx)("h1",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Acesso Negado"}),(0,l.jsx)("p",{className:"text-slate-600 mb-6",children:"Voc\xea n\xe3o tem permiss\xe3o para acessar o painel administrativo."}),(0,l.jsx)("a",{href:"/profile",className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Voltar ao Perfil"})]})}),children:(0,l.jsxs)("div",{className:"min-h-screen bg-slate-50",children:[(0,l.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,l.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-slate-900",children:"Painel Administrativo"}),(0,l.jsxs)("p",{className:"text-slate-600",children:["Bem-vindo, ",(null==e?void 0:e.firstName)||(null==e?void 0:e.name)||(null==e?void 0:e.email)]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)("span",{className:"px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium",children:null==e?void 0:e.role}),(0,l.jsx)("a",{href:"/profile",className:"text-slate-600 hover:text-slate-900 transition-colors",children:"Voltar ao Perfil"})]})]})})}),(0,l.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[h&&(0,l.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:(0,l.jsx)("p",{className:"text-red-800",children:h})}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Total de Usu\xe1rios"}),(0,l.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:i.length}),(0,l.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:"Usu\xe1rios cadastrados"})]}),(0,l.jsx)(_,{permission:v.AUDIT_LOG_READ,children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Eventos de Auditoria"}),(0,l.jsx)("p",{className:"text-3xl font-bold text-green-600",children:o.length}),(0,l.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:"Eventos recentes"})]})}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Suas Permiss\xf5es"}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"w-2 h-2 rounded-full mr-2 ".concat(t(v.USER_READ)?"bg-green-500":"bg-red-500")}),(0,l.jsx)("span",{className:"text-sm text-slate-600",children:"Gerenciar Usu\xe1rios"})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"w-2 h-2 rounded-full mr-2 ".concat(t(v.AUDIT_LOG_READ)?"bg-green-500":"bg-red-500")}),(0,l.jsx)("span",{className:"text-sm text-slate-600",children:"Visualizar Auditoria"})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"w-2 h-2 rounded-full mr-2 ".concat(t(v.SYSTEM_CONFIG)?"bg-green-500":"bg-red-500")}),(0,l.jsx)("span",{className:"text-sm text-slate-600",children:"Configura\xe7\xe3o do Sistema"})]})]})]})]}),(0,l.jsx)(_,{permission:v.USER_READ,children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow mb-8",children:[(0,l.jsx)("div",{className:"px-6 py-4 border-b border-slate-200",children:(0,l.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:"Usu\xe1rios Recentes"})}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full divide-y divide-slate-200",children:[(0,l.jsx)("thead",{className:"bg-slate-50",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Usu\xe1rio"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Role"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Criado em"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Status"})]})}),(0,l.jsx)("tbody",{className:"bg-white divide-y divide-slate-200",children:i.map(e=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm font-medium text-slate-900",children:e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):"Nome n\xe3o informado"}),(0,l.jsx)("div",{className:"text-sm text-slate-500",children:e.email})]})}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,l.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat("ADMIN"===e.role?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"),children:e.role})}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500",children:new Date(e.createdAt).toLocaleDateString("pt-BR")}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,l.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(e.emailVerified?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e.emailVerified?"Verificado":"Pendente"})})]},e.id))})]})})]})}),(0,l.jsx)(_,{permission:v.AUDIT_LOG_READ,children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,l.jsx)("div",{className:"px-6 py-4 border-b border-slate-200",children:(0,l.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:"Eventos de Auditoria Recentes"})}),(0,l.jsx)("div",{className:"divide-y divide-slate-200",children:o.slice(0,5).map(e=>(0,l.jsx)("div",{className:"px-6 py-4",children:(0,l.jsx)("div",{className:"flex items-start justify-between",children:(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-slate-900",children:e.eventType.replace(/_/g," ")}),(0,l.jsx)("span",{className:"ml-2 px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs",children:new Date(e.timestamp).toLocaleString("pt-BR")})]}),e.user&&(0,l.jsxs)("p",{className:"text-sm text-slate-600 mt-1",children:["Usu\xe1rio: ",e.user.firstName&&e.user.lastName?"".concat(e.user.firstName," ").concat(e.user.lastName):e.user.email]}),e.ip&&(0,l.jsxs)("p",{className:"text-sm text-slate-500 mt-1",children:["IP: ",e.ip]})]})})},e.id))})]})})]})]})})}}},function(e){e.O(0,[218,998,700,649,971,23,744],function(){return e(e.s=2802)}),_N_E=e.O()}]);