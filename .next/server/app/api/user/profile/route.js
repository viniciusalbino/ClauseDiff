"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},90455:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>v,requestAsyncStorage:()=>x,routeModule:()=>N,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h});var a={};t.r(a),t.d(a,{DELETE:()=>g,GET:()=>p,PUT:()=>f});var s=t(49303),i=t(88716),o=t(60670),n=t(87070),l=t(45609),u=t(26109),m=t(20728),c=t(9133);let d=c.z.object({firstName:c.z.string().min(1,"Nome \xe9 obrigat\xf3rio").max(50,"Nome deve ter no m\xe1ximo 50 caracteres"),lastName:c.z.string().min(1,"Sobrenome \xe9 obrigat\xf3rio").max(50,"Sobrenome deve ter no m\xe1ximo 50 caracteres"),city:c.z.string().max(100,"Cidade deve ter no m\xe1ximo 100 caracteres").optional().or(c.z.literal("")),state:c.z.string().max(50,"Estado deve ter no m\xe1ximo 50 caracteres").optional().or(c.z.literal("")),cpf:c.z.string().optional().or(c.z.literal("")).refine(e=>!e||11===e.replace(/\D/g,"").length,"CPF deve ter 11 d\xedgitos")});async function p(){try{let e=await (0,l.getServerSession)(u.L);if(!e?.user?.email)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let r=await m._.user.findUnique({where:{email:e.user.email},select:{id:!0,email:!0,firstName:!0,lastName:!0,city:!0,state:!0,cpf:!0,role:!0,createdAt:!0,updatedAt:!0}});if(!r)return n.NextResponse.json({error:"Usu\xe1rio n\xe3o encontrado"},{status:404});return n.NextResponse.json({success:!0,user:r})}catch(e){return console.error("Error fetching user profile:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function f(e){try{let r=await (0,l.getServerSession)(u.L);if(!r?.user?.email)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let t=await e.json(),a=d.parse(t),s=a.cpf?a.cpf.replace(/\D/g,""):null;if(s&&await m._.user.findFirst({where:{cpf:s,email:{not:r.user.email}}}))return n.NextResponse.json({error:"CPF j\xe1 est\xe1 em uso por outro usu\xe1rio"},{status:400});let i=await m._.user.update({where:{email:r.user.email},data:{firstName:a.firstName,lastName:a.lastName,city:a.city||null,state:a.state||null,cpf:s,updatedAt:new Date},select:{id:!0,email:!0,firstName:!0,lastName:!0,city:!0,state:!0,cpf:!0,role:!0,createdAt:!0,updatedAt:!0}});return await m._.auditLog.create({data:{userId:i.id,eventType:"PROFILE_UPDATE",ip:e.ip||e.headers.get("x-forwarded-for")||"unknown",userAgent:e.headers.get("user-agent"),details:{updatedFields:Object.keys(a),timestamp:new Date().toISOString()}}}),n.NextResponse.json({success:!0,message:"Perfil atualizado com sucesso",user:i})}catch(e){if(console.error("Error updating user profile:",e),e instanceof c.z.ZodError)return n.NextResponse.json({error:"Dados inv\xe1lidos",details:e.errors[0]?.message||"Dados de entrada inv\xe1lidos",field:e.errors[0]?.path[0]||"unknown"},{status:400});return n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function g(e){try{let r=await (0,l.getServerSession)(u.L);if(!r?.user?.email)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let t=await m._.user.findUnique({where:{email:r.user.email}});if(!t)return n.NextResponse.json({error:"Usu\xe1rio n\xe3o encontrado"},{status:404});return await m._.auditLog.create({data:{userId:t.id,eventType:"ACCOUNT_DELETE",ip:e.ip||e.headers.get("x-forwarded-for")||"unknown",userAgent:e.headers.get("user-agent"),details:{email:t.email,timestamp:new Date().toISOString()}}}),await m._.user.delete({where:{email:r.user.email}}),n.NextResponse.json({success:!0,message:"Conta exclu\xedda com sucesso"})}catch(e){return console.error("Error deleting user account:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let N=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/user/profile/route",pathname:"/api/user/profile",filename:"route",bundlePath:"app/api/user/profile/route"},resolvedPagePath:"/Users/viniciusalbino/Documents/GitHub/clausediff.nosync/app/api/user/profile/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:h,serverHooks:w}=N,y="/api/user/profile/route";function v(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}},26109:(e,r,t)=>{t.d(r,{L:()=>c});var a=t(77234),s=t(53797),i=t(13539),o=t(20728),n=t(42023),l=t.n(n),u=t(9133);let m=u.z.object({email:u.z.string().email(),password:u.z.string().min(6)}),c={adapter:(0,i.N)(o._),providers:[(0,s.Z)({name:"Email e Senha",credentials:{email:{label:"Email",type:"email",placeholder:"seu@email.com"},password:{label:"Senha",type:"password"}},async authorize(e){let r=m.safeParse(e);if(!r.success)throw Error("Credenciais inv\xe1lidas");let{email:t,password:a}=r.data,s=await o._.user.findUnique({where:{email:t}});if(!s||!s.password||!await l().compare(a,s.password))throw Error("Usu\xe1rio ou senha inv\xe1lidos");return{id:s.id,email:s.email,name:s.name||`${s.firstName||""} ${s.lastName||""}`.trim()||null,image:s.image,firstName:s.firstName,lastName:s.lastName,emailVerified:s.emailVerified,role:s.role}}}),...process.env.GOOGLE_CLIENT_ID&&process.env.GOOGLE_CLIENT_SECRET?[(0,a.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,authorization:{params:{scope:"openid email profile"}},profile:e=>({id:e.sub,name:e.name||null,email:e.email,image:e.picture||null,emailVerified:e.email_verified?new Date:null,firstName:e.given_name||null,lastName:e.family_name||null})})]:[]],session:{strategy:"jwt",maxAge:2592e3,updateAge:86400},jwt:{maxAge:900},pages:{signIn:"/login",error:"/login"},useSecureCookies:!0,cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"strict",path:"/",secure:!0}},callbackUrl:{name:"__Secure-next-auth.callback-url",options:{httpOnly:!0,sameSite:"strict",path:"/",secure:!0}},csrfToken:{name:"__Host-next-auth.csrf-token",options:{httpOnly:!1,sameSite:"strict",path:"/",secure:!0}}},callbacks:{async signIn({user:e,account:r,profile:t}){if(r?.provider==="google"&&t&&e.id){let r={};t.picture&&t.picture!==e.image&&(r.image=t.picture);let a=t.email_verified?new Date:null,s=e.emailVerified;if(a?.getTime()!==(s instanceof Date?s.getTime():null)&&(r.emailVerified=a),t.given_name&&t.given_name!==e.firstName&&(r.firstName=t.given_name),t.family_name&&t.family_name!==e.lastName&&(r.lastName=t.family_name),t.name&&t.name!==e.name&&(r.name=t.name),Object.keys(r).length>0)try{await o._.user.update({where:{id:e.id},data:r})}catch(e){console.error("Error updating user in signIn callback:",e)}}return!0},async jwt({token:e,user:r}){r&&(e.id=r.id,e.role=r.role,e.firstName=r.firstName,e.lastName=r.lastName,e.city=r.city,e.state=r.state,e.cpf=r.cpf,e.emailVerified=r.emailVerified);let t=Math.floor(Date.now()/1e3),a=e.iat||t;if(t-a>300&&e.email)try{let r=await o._.user.findUnique({where:{email:e.email},select:{id:!0,email:!0,name:!0,firstName:!0,lastName:!0,city:!0,state:!0,cpf:!0,role:!0,emailVerified:!0}});r&&(e.id=r.id,e.role=r.role,e.firstName=r.firstName,e.lastName=r.lastName,e.city=r.city,e.state=r.state,e.cpf=r.cpf,e.emailVerified=r.emailVerified,e.iat=t)}catch(e){console.error("Error refreshing JWT token:",e)}return e},session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id,e.user.role=r.role,e.user.firstName=r.firstName,e.user.lastName=r.lastName,e.user.city=r.city,e.user.state=r.state,e.user.cpf=r.cpf,e.user.emailVerified=r.emailVerified),e),redirect:async({url:e,baseUrl:r})=>e.startsWith("/")?`${r}${e}`:new URL(e).origin===r?e:r}}},20728:(e,r,t)=>{t.d(r,{_:()=>s});let a=require("@prisma/client"),s=globalThis.prisma??new a.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[948,532,70,23,330,575],()=>t(90455));module.exports=a})();